<div class="onboarding-container">
    <div class="onboarding-navigation">
        {% if current_step > 1 %}
            <button class="onboarding-btn prev-step-btn">Previous Step</button>
        {% endif %}
        {% if current_step < 5 %}
            <button class="onboarding-btn next-step-btn" {% if not can_proceed %}disabled{% endif %}>Next Step</button>
        {% endif %}
        {% if current_step == 5 %}
            <button id="finish-setup" class="onboarding-btn finish-setup-btn" disabled>Finish Setup</button>
        {% endif %}
    </div>
</div>

<style>
    .popup-content.confirm {
        max-width: 50vw !important;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const prevStepBtn = document.querySelector('.prev-step-btn');
    const nextStepBtn = document.querySelector('.next-step-btn');
    const finishSetupBtn = document.getElementById('finish-setup');

    if (prevStepBtn) {
        prevStepBtn.addEventListener('click', function() {
            window.location.href = '{{ url_for("onboarding.onboarding_step", step=current_step-1) }}';
        });
    }

    if (nextStepBtn) {
        const currentStep = parseInt('{{ current_step }}');
        if (currentStep !== 2) {
            nextStepBtn.addEventListener('click', function() {
                if (!this.disabled) {
                    window.location.href = '{{ url_for("onboarding.onboarding_step", step=current_step+1) }}';
                }
            });
        }
    }

    if (finishSetupBtn) {
        finishSetupBtn.addEventListener('click', function() {
            import('/static/js/notifications.js').then(({ showPopup, POPUP_TYPES }) => {
                showPopup({
                    type: POPUP_TYPES.CONFIRM,
                    title: 'Complete Setup',
                    message: `
                        <p>Your cli_debrid instance is now configured and ready to use!</p>
                        <p><strong>Here's what happens next:</strong></p>
                        <ul style="list-style-type: none; padding-left: 0; margin: 15px 0;">
                            <li style="margin-bottom: 8px;">â€¢ The start button and the top right controls program operations</li>
                            <li style="margin-bottom: 8px;">â€¢ Consider setting up webhooks for <a href="https://wiki.godver3.xyz/en/home#overseerr" target="_blank" style="color: #3498db;">Overseerr</a> and <a href="https://wiki.godver3.xyz/en/home#zurg" target="_blank" style="color: #3498db;">Zurg</a> (if using Symlinks)</li>
                            <li style="margin-bottom: 8px;">â€¢ Check the <a href="https://github.com/godver3/cli_debrid" target="_blank" style="color: #3498db;">GitHub page</a> or the <a href="https://wiki.godver3.xyz/" target="_blank" style="color: #3498db;">Wiki</a> for more information</li>
                            <li style="margin-bottom: 8px;">â€¢ Look through the settings menu - there are lots of options to customize cli_debrid</li>
                            <li style="margin-bottom: 8px;">â€¢ Set up your Versions to customize the content you scrape</li>
                            <li style="margin-bottom: 8px;">â€¢ If you have any questions - feel free to join the <a href="https://discord.gg/ynqnXGJ4hU" target="_blank" style="color: #3498db;">Discord server</a> and ask away!</li>
                        </ul>
                        <div class="advice-section">
                            <div class="advice-header">
                                ðŸ’¡ Want my advice?
                                <i class="fas fa-chevron-down toggle-icon"></i>
                            </div>
                            <div class="advice-content">
                                I'd recommend that you don't try to replicate entire streaming libraries. Collecting is fun, but don't spam service providers. Above all - make sure you watch your content! It's more fun - I swear.
                            </div>
                        </div>
                        <p>Would you like to proceed to the dashboard?</p>
                    `,
                    confirmText: 'Go to Dashboard',
                    cancelText: 'Stay Here',
                    onConfirm: () => {
                        // Complete onboarding and redirect to dashboard
                        fetch('{{ url_for("onboarding.complete_onboarding") }}', {
                            method: 'POST',
                        })
                        .then(response => response.json())
                        .then(result => {
                            if (result.success) {
                                window.location.href = '{{ url_for("root.root") }}';
                            } else {
                                showPopup({
                                    type: POPUP_TYPES.ERROR,
                                    title: 'Error',
                                    message: 'Failed to complete setup: ' + result.error
                                });
                            }
                        });
                    }
                });

                // Add click handler for advice section toggle
                setTimeout(() => {
                    const adviceHeader = document.querySelector('.popup-content .advice-header');
                    if (adviceHeader) {
                        adviceHeader.addEventListener('click', () => {
                            const section = adviceHeader.closest('.advice-section');
                            section.classList.toggle('expanded');
                        });
                    }
                }, 100);
            });
        });
    }
});
</script>